# ==============================
# ACTUATOR & HEALTH CHECK
# ==============================
management.endpoints.web.exposure.include=health
management.endpoint.health.show-details=always

spring.config.import=optional:classpath:.env[.properties]

spring.application.name=${SPRING_APP_NAME}
server.port=${SERVER_PORT}

# ========================================
# DATABASE CONFIGURATION WITH UTF-8
# ========================================
spring.datasource.url=${DB_URL}
spring.datasource.username=${DB_USERNAME}
spring.datasource.password=${DB_PASSWORD}

spring.jpa.hibernate.ddl-auto=update
spring.jpa.show-sql=true
spring.jpa.properties.hibernate.dialect=org.hibernate.dialect.MySQLDialect

# UTF-8 Encoding for Database
spring.datasource.hikari.connection-init-sql=SET NAMES utf8mb4 COLLATE utf8mb4_unicode_ci
spring.jpa.properties.hibernate.connection.characterEncoding=utf-8
spring.jpa.properties.hibernate.connection.CharSet=utf-8
spring.jpa.properties.hibernate.connection.useUnicode=true

# ========================================
# HTTP ENCODING (UTF-8)
# ========================================
server.servlet.encoding.charset=UTF-8
server.servlet.encoding.enabled=true
server.servlet.encoding.force=true

# ========================================
# KAFKA CONFIGURATION
# ========================================
spring.kafka.bootstrap-servers=${KAFKA_BOOTSTRAP_SERVERS}
spring.kafka.consumer.group-id=ai-service-group
spring.kafka.consumer.auto-offset-reset=earliest
spring.kafka.consumer.key-deserializer=org.springframework.kafka.support.serializer.ErrorHandlingDeserializer
spring.kafka.consumer.value-deserializer=org.springframework.kafka.support.serializer.ErrorHandlingDeserializer
spring.kafka.consumer.properties.spring.deserializer.key.delegate.class=org.apache.kafka.common.serialization.StringDeserializer
spring.kafka.consumer.properties.spring.deserializer.value.delegate.class=org.springframework.kafka.support.serializer.JsonDeserializer
spring.kafka.consumer.properties.spring.json.trusted.packages=com.ev.inventory_service.model,com.ev.common_lib.model,com.ev.common_lib.event
spring.kafka.consumer.properties.spring.json.value.default.type=com.ev.common_lib.model.InventoryTransactionEvent
spring.kafka.consumer.properties.spring.json.type.mapping=com.ev.inventory_service.model.InventoryTransaction:com.ev.common_lib.model.InventoryTransactionEvent

# Kafka Topics
kafka.topic.inventory-events=inventory_events
kafka.topic.product-events=product_events
kafka.topic.stock-events-dealer=stock_events_dealerEVM

# External Service URLs
# User Service - để lấy thông tin nhân viên (đã tích hợp với User Service thực tế)
user.service.url=${USER_SERVICE_URL}

# Vehicle Service - để lấy thông tin xe
vehicle.service.url=${VEHICLE_SERVICE_URL}

# Dealer Service - để lấy thông tin dealer và region
dealer.service.url=${DEALER_SERVICE_URL}

# Sales Service - để lấy lịch sử bán hàng cho AI forecasting
sales.service.url=${SALES_SERVICE_URL}

# Inventory Service - để lấy snapshot tồn kho cho AI forecasting
inventory.service.url=${INVENTORY_SERVICE_URL}

# Notification Service - để gửi thông báo
notification.service.url=${NOTIFICATION_SERVICE_URL}

# ========================================
# REDIS (GENERAL & CACHE)
# ========================================
# Quan trọng: Dùng biến môi trường để switch localhost/redis-db
spring.data.redis.host=${SPRING_REDIS_HOST:localhost}
spring.data.redis.port=${SPRING_REDIS_PORT:6379}

# ========================================
# GOOGLE GENAI CONFIGURATION (GEMINI)
# ========================================
# Key lấy từ aistudio.google.com
spring.ai.google.genai.api-key=${GOOGLE_AI_API_KEY}
# Dummy project-id to satisfy Spring AI 1.1.2 embedding starter validation
spring.ai.google.genai.project-id=${SPRING_APP_NAME:ai-service}
spring.ai.google.genai.location=us-central1

# Chọn model của Google
spring.ai.google.genai.chat.options.model=gemini-1.5-flash
spring.ai.google.genai.chat.options.temperature=0.7

# --- EMBEDDING CONFIG ---
# Enable Google GenAI Embedding (API based)
spring.ai.model.embedding.text=google-genai
spring.ai.google.genai.embedding.api-key=${GOOGLE_AI_API_KEY}
spring.ai.google.genai.embedding.text.options.model=gemini-embedding-001

# Transformers Embedding (Local ONNX) disabled to save RAM
spring.ai.transformers.embedding.enabled=false

# Redis Vector Store
spring.ai.vectorstore.redis.uri=redis://${SPRING_REDIS_HOST:localhost}:${SPRING_REDIS_PORT:6379}
spring.ai.vectorstore.redis.index=vehicle-knowledge-base-v4
spring.ai.vectorstore.redis.initialize-schema=true

# ========================================
# TEST DRIVE APPOINTMENT SETTINGS
# ========================================

# Notification Settings
notification.enabled=${NOTIFICATION_ENABLED}

# Email Settings (SendGrid - optional, cần config nếu sử dụng)
# sendgrid.api.key=${SENDGRID_API_KEY:}
# sendgrid.from.email=${SENDGRID_FROM_EMAIL:noreply@evdealer.com}
# sendgrid.from.name=${SENDGRID_FROM_NAME:EV Dealer System}

# SMS Settings (Twilio - optional, cần config nếu sử dụng)
# twilio.account.sid=${TWILIO_ACCOUNT_SID:}
# twilio.auth.token=${TWILIO_AUTH_TOKEN:}
# twilio.phone.number=${TWILIO_PHONE_NUMBER:}

# Business Rules
testdrive.min.duration.minutes=15
testdrive.max.duration.minutes=240
testdrive.min.advance.hours=2
testdrive.business.hours.start=8
testdrive.business.hours.end=18

# Reminder Scheduler Settings
reminder.schedule.cron=0 0 10 * * *
reminder.hours.before=24

# Confirmation Scheduler Settings (check every hour)
confirmation.schedule.cron=0 0 * * * *

# Enable Spring Scheduling
spring.task.scheduling.enabled=true

# ========================================
# EMAIL CONFIRMATION SETTINGS
# ========================================

# Spring Mail Configuration (using Gmail SMTP as example)
spring.mail.host=${MAIL_HOST}
spring.mail.port=${MAIL_PORT}
spring.mail.username=${MAIL_USERNAME}
spring.mail.password=${MAIL_PASSWORD}
spring.mail.properties.mail.smtp.auth=true
spring.mail.properties.mail.smtp.starttls.enable=true
spring.mail.properties.mail.smtp.ssl.trust=smtp.gmail.com

# Application URLs
app.base-url=${APP_BASE_URL}
app.frontend-url=${APP_FRONTEND_URL}

# Suppress static resource warnings
spring.web.resources.add-mappings=false
logging.level.org.springframework.web.servlet.resource.ResourceHttpRequestHandler=ERROR

# ========================================
# LOGGING CONFIGURATION WITH UTF-8
# ========================================
logging.level.root=INFO
logging.level.com.ev.ai_service=DEBUG
logging.level.org.springframework.web=INFO
logging.level.org.hibernate.SQL=DEBUG
logging.level.org.hibernate.type.descriptor.sql.BasicBinder=TRACE
logging.pattern.console=%d{yyyy-MM-dd HH:mm:ss} [%thread] %-5level %logger{36} - %msg%n
logging.charset.console=UTF-8
logging.charset.file=UTF-8

