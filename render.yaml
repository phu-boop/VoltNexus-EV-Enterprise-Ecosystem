services:
  # AI Service - Primary Application
  - type: web
    name: ai-service
    runtime: docker
    dockerContext: .
    dockerfilePath: services/ai-service/Dockerfile
    plan: free
    healthCheckPath: /actuator/health
    envVars:
      - key: SPRING_APP_NAME
        value: ai-service
      - key: SERVER_PORT
        value: 8500
      - key: DB_URL
        value: jdbc:mysql://vms-commerce14-tmdtvmscommerce.i.aivencloud.com:25858/ai_service_db?sslMode=REQUIRED&autoReconnect=true&useUnicode=true&characterEncoding=UTF-8
      - key: DB_USERNAME
        sync: false
      - key: DB_PASSWORD
        sync: false
      - key: GOOGLE_AI_API_KEY
        sync: false
      - key: REDIS_HOST
        fromService:
          name: ai-redis
          type: host
      - key: REDIS_PORT
        fromService:
          name: ai-redis
          type: port
      - key: KAFKA_BOOTSTRAP_SERVERS
        value: kafka-external:9092
      - key: NOTIFICATION_ENABLED
        value: "true"

  # Redis Service - Required for AI Vector Store
  - type: redis
    name: ai-redis
    plan: free
    ipAllowList: [] # Only allow internal connections
